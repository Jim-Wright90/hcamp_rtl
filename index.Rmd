---
title: "HCAMP RTL"
output:
  html_document:
    toc: true
    toc_float: true
    theme: spacelab
    highlight: tango 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r, include=FALSE}
library(tidyverse)
library(here)
library(janitor)
library(rio)
library(colorblindr)
library(gghighlight)
library(forcats)
library(ggrepel)
library(gt)
library(knitr)
library(kableExtra)
library(reactable)
library(plotly)
library(glue)
library(fs)
library(rstatix)
library(ggpubr)
library(writexl)

theme_set(theme_minimal(15) +
            theme(legend.position = "bottom",
                  panel.grid.major.x = element_line(color = "gray60"),
                  panel.grid.minor.x = element_blank(),
                  panel.grid.major.y = element_blank())
          )


biif <- import(here("data", "BIIF.xlsx"),
               setclass = "tbl_df") %>% 
  janitor::clean_names() %>% 
  select(c(1:12, 19, 21, 26:32))

biif$onset <- as.Date(biif$onset, format = "%m/%d/%Y")
biif$rtp_protocol_7 <- as.Date(biif$rtp_protocol_7, format = "%m/%d/%Y")
biif$rtp_protocol_1_cognitive_physical_rest <- as.Date(biif$rtp_protocol_1_cognitive_physical_rest, format = "%m/%d/%Y")
biif$rtp_protocol_2_return_to_school_full_time <- as.Date(biif$rtp_protocol_2_return_to_school_full_time, format = "%m/%d/%Y")
biif$rtp_protocol_3_light_exercise <- as.Date(biif$rtp_protocol_3_light_exercise, format = "%m/%d/%Y")
biif$rtp_protocol_4_running_no_equipment <- as.Date(biif$rtp_protocol_4_running_no_equipment, format = "%m/%d/%Y")
biif$rtp_protocol_5_non_contact_drills <- as.Date(biif$rtp_protocol_5_non_contact_drills, format = "%m/%d/%Y")
biif$rtp_protocol_6_full_contact_practice <- as.Date(biif$rtp_protocol_6_full_contact_practice, format = "%m/%d/%Y")
biif$rtp_protocol_7_returned_to_full_unrestricted_activity <- as.Date(biif$rtp_protocol_7_returned_to_full_unrestricted_activity, format = "%m/%d/%Y")

str(biif)

oia <- import(here("data", "OIA.xlsx"),
               setclass = "tbl_df") %>% 
  janitor::clean_names() %>% 
  select(c(1:12, 19, 21, 26:32))

oia$onset <- as.Date(oia$onset, format = "%m/%d/%Y")
oia$rtp_protocol_7 <- as.Date(oia$rtp_protocol_7, format = "%m/%d/%Y")
oia$rtp_protocol_1_cognitive_physical_rest <- as.Date(oia$rtp_protocol_1_cognitive_physical_rest, format = "%m/%d/%Y")
oia$rtp_protocol_2_return_to_school_full_time <- as.Date(oia$rtp_protocol_2_return_to_school_full_time, format = "%m/%d/%Y")
oia$rtp_protocol_3_light_exercise <- as.Date(oia$rtp_protocol_3_light_exercise, format = "%m/%d/%Y")
oia$rtp_protocol_4_running_no_equipment <- as.Date(oia$rtp_protocol_4_running_no_equipment, format = "%m/%d/%Y")
oia$rtp_protocol_5_non_contact_drills <- as.Date(oia$rtp_protocol_5_non_contact_drills, format = "%m/%d/%Y")
oia$rtp_protocol_6_full_contact_practice <- as.Date(oia$rtp_protocol_6_full_contact_practice, format = "%m/%d/%Y")
oia$rtp_protocol_7_returned_to_full_unrestricted_activity <- as.Date(oia$rtp_protocol_7_returned_to_full_unrestricted_activity, format = "%m/%d/%Y")


kif <- import(here("data", "KIF.xlsx"),
               setclass = "tbl_df") %>% 
  janitor::clean_names() %>% 
  select(c(1:12, 19, 21, 26:32))


kif$onset <- as.Date(kif$onset, format = "%m/%d/%Y")
kif$rtp_protocol_7 <- as.Date(kif$rtp_protocol_7, format = "%m/%d/%Y")
kif$rtp_protocol_1_cognitive_physical_rest <- as.Date(kif$rtp_protocol_1_cognitive_physical_rest, format = "%m/%d/%Y")
kif$rtp_protocol_2_return_to_school_full_time <- as.Date(kif$rtp_protocol_2_return_to_school_full_time, format = "%m/%d/%Y")
kif$rtp_protocol_3_light_exercise <- as.Date(kif$rtp_protocol_3_light_exercise, format = "%m/%d/%Y")
kif$rtp_protocol_4_running_no_equipment <- as.Date(kif$rtp_protocol_4_running_no_equipment, format = "%m/%d/%Y")
kif$rtp_protocol_5_non_contact_drills <- as.Date(kif$rtp_protocol_5_non_contact_drills, format = "%m/%d/%Y")
kif$rtp_protocol_6_full_contact_practice <- as.Date(kif$rtp_protocol_6_full_contact_practice, format = "%m/%d/%Y")
kif$rtp_protocol_7_returned_to_full_unrestricted_activity <- as.Date(kif$rtp_protocol_7_returned_to_full_unrestricted_activity, format = "%m/%d/%Y")


mil <- import(here("data", "MIL.xlsx"),
               setclass = "tbl_df") %>% 
  janitor::clean_names() %>% 
  select(c(1:12, 19, 21, 26:32))


mil$onset <- as.Date(mil$onset, format = "%m/%d/%Y")
mil$rtp_protocol_7 <- as.Date(mil$rtp_protocol_7, format = "%m/%d/%Y")
mil$rtp_protocol_1_cognitive_physical_rest <- as.Date(mil$rtp_protocol_1_cognitive_physical_rest, format = "%m/%d/%Y")
mil$rtp_protocol_2_return_to_school_full_time <- as.Date(mil$rtp_protocol_2_return_to_school_full_time, format = "%m/%d/%Y")
mil$rtp_protocol_3_light_exercise <- as.Date(mil$rtp_protocol_3_light_exercise, format = "%m/%d/%Y")
mil$rtp_protocol_4_running_no_equipment <- as.Date(mil$rtp_protocol_4_running_no_equipment, format = "%m/%d/%Y")
mil$rtp_protocol_5_non_contact_drills <- as.Date(mil$rtp_protocol_5_non_contact_drills, format = "%m/%d/%Y")
mil$rtp_protocol_6_full_contact_practice <- as.Date(mil$rtp_protocol_6_full_contact_practice, format = "%m/%d/%Y")
mil$rtp_protocol_7_returned_to_full_unrestricted_activity <- as.Date(mil$rtp_protocol_7_returned_to_full_unrestricted_activity, format = "%m/%d/%Y")

str(kif)
str(mil)
str(biif)
str(oia)


all_leagues <- bind_rows(biif, oia, kif, mil, .id = "dataset")

all_leagues <- all_leagues %>% 
  mutate(age = round(age)) %>% 
  mutate(gender = recode(gender,
                         `F` = "Female",
                         `M` = "Male"),
         level = recode(level, 
                        `JV` = "Junior Varsity"))
  

mean_2 <- function(x) {
  z <- na.omit(x)
  sum(z) / length(z)
}

my_mean <- function(x) {
  mean(x[x >= 0], na.rm = TRUE)
}

mean_2(all_leagues$days_missed)
my_mean(all_leagues$days_missed)


create_react_time <- function(df, var) {
    df %>% 
      summarize(Mean = mean({{var}}),
                SD = sd({{var}}),
                Min = min({{var}}),
                Max = max({{var}}),
                Total = length({{var}})) %>% 
      mutate_if(is.numeric, round, 2) %>% 
      reactable(columns = list(
        Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
        SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
        Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
        Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
        Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ))
}

create_react <- function(df, var) {
    df %>% 
      summarize(Mean = mean({{var}}),
                SD = sd({{var}}),
                Min = min({{var}}),
                Max = max({{var}}),
                Total = length({{var}})) %>% 
      mutate_if(is.numeric, round, 2) %>% 
      reactable(columns = list(
        Mean = colDef(format = colFormat(separators = TRUE)),
        SD = colDef(format = colFormat(separators = TRUE)),
        Min = colDef(format = colFormat(separators = TRUE)),
        Max = colDef(format = colFormat(separators = TRUE)),
        Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ))
}
```


```{r, include=FALSE}
#identifying concussion injuries 

all_leagues$injury

all_concussion <- all_leagues %>% 
  filter(injury == "Head Concussion") %>% 
  mutate(days_between_onset_rtp_7 = rtp_protocol_7 - onset) %>% 
  drop_na(onset, rtp_protocol_7) %>% 
  mutate(days_between_onset_rtp_7 = as.numeric(days_between_onset_rtp_7)) %>% 
  filter(days_between_onset_rtp_7 >= 0)


mean_2(all_concussion$days_between_onset_rtp_7)


all_rtp <- all_leagues %>% 
  filter(injury == "Head Concussion") %>% 
  drop_na(onset, 
          rtp_protocol_1_cognitive_physical_rest, 
          rtp_protocol_2_return_to_school_full_time,
          rtp_protocol_3_light_exercise,
          rtp_protocol_4_running_no_equipment,
          rtp_protocol_5_non_contact_drills,
          rtp_protocol_6_full_contact_practice,
          rtp_protocol_7) %>% 
  mutate(onset_rtl_total_days = rtp_protocol_2_return_to_school_full_time - onset,
         rtl_rtp_total_days = rtp_protocol_7 - rtp_protocol_2_return_to_school_full_time,
         onset_rtp_total_days = rtp_protocol_7 - onset) %>% 
  mutate(onset_rtl_total_days = as.numeric(onset_rtl_total_days),
         rtl_rtp_total_days = as.numeric(rtl_rtp_total_days),
         onset_rtp_total_days = as.numeric(onset_rtp_total_days)) %>% 
  filter(onset_rtl_total_days >= 0,
         rtl_rtp_total_days >= 0,
         onset_rtp_total_days >= 0) 

  
all_rtp %>% 
  count(last_name) %>% 
  reactable()

  
rtl_update <- all_leagues %>% 
  filter(injury == "Head Concussion") %>% 
  select(-c(16, 18, 19, 20, 21, 22)) %>% 
  mutate(onset_rtl_total_days = rtp_protocol_2_return_to_school_full_time - onset,
         rtl_rtp_total_days = rtp_protocol_7 - rtp_protocol_2_return_to_school_full_time,
         onset_rtp_total_days = rtp_protocol_7 - onset) %>% 
  drop_na(onset, 
          rtp_protocol_2_return_to_school_full_time, 
          rtp_protocol_7) %>% 
  mutate(onset_rtl_total_days = as.numeric(onset_rtl_total_days),
         rtl_rtp_total_days = as.numeric(rtl_rtp_total_days),
         onset_rtp_total_days = as.numeric(onset_rtp_total_days)) %>% 
  filter(onset_rtl_total_days >= 0,
         rtl_rtp_total_days >= 0,
         onset_rtp_total_days >= 0) %>% 
  select(c(1:13, 16, 14, 15, 17, 18, 19))
  

```


```{r, include=FALSE}
files <- dir_ls(here::here("data"), glob = "*.csv")

d <- map_df(files, read_csv, .id = "file",
                 col_types = cols(.default = "c")) %>% 
  modify(~parse_guess(.x)) %>% 
  janitor::clean_names() %>% 
  mutate(year = parse_number(file)) %>% 
  mutate(year = as.factor(year))

d <- d %>% 
  mutate(first_name = str_to_title(first_name),
         last_name = str_to_title(last_name))

impact <- d %>% 
  select(year,
         passport_id, 
         first_name,
         last_name,
         user_gender,
         user_age,
         user_current_sport,
         user_number_of_concussions,
         test_date,
         test_type,
         user_memory_composite_score_verbal,
         user_memory_composite_score_visual,
         user_visual_motor_composite_score,
         user_impulse_control_composite_score,
         user_reaction_time_composite_score,
         user_symptom1,
         user_symptom2,
         user_symptom3,
         user_symptom4,
         user_symptom5,
         user_symptom6,
         user_symptom7,
         user_symptom8,
         user_symptom9,
         user_symptom10,
         user_symptom11,
         user_symptom12,
         user_symptom13,
         user_symptom14,
         user_symptom15,
         user_symptom16,
         user_symptom17,
         user_symptom18,
         user_symptom19,
         user_symptom20,
         user_symptom21,
         user_symptom22,
         user_total_symptom_score) %>% 
  rename(gender = user_gender,
         age = user_age,
         current_sport = user_current_sport,
         number_of_concussions = user_number_of_concussions,
         verbal_memory = user_memory_composite_score_verbal,
         visual_memory = user_memory_composite_score_visual, 
         visual_motor = user_visual_motor_composite_score,
         impulse_control = user_impulse_control_composite_score,
         reaction_time = user_reaction_time_composite_score,
         pcss_headache = user_symptom1,
         pcss_nausea = user_symptom2,
         pcss_vomiting = user_symptom3,
         pcss_balance_problems = user_symptom4,
         pcss_dizziness = user_symptom5,
         pcss_fatigue = user_symptom6,
         pcss_trouble_falling_asleep = user_symptom7,
         pcss_excessive_sleep = user_symptom8,
         pcss_loss_of_sleep = user_symptom9,
         pcss_drowsiness = user_symptom10,
         pcss_light_sensitivity = user_symptom11,
         pcss_noise_sensitivity = user_symptom12,
         pcss_irritability = user_symptom13,
         pcss_sadness = user_symptom14,
         pcss_nervousness = user_symptom15,
         pcss_more_emotional = user_symptom16,
         pcss_numbness = user_symptom17,
         pcss_feeling_slow = user_symptom18,
         pcss_feeling_foggy = user_symptom19,
         pcss_difficulty_concentrating = user_symptom20,
         pcss_difficulty_remembering = user_symptom21,
         pcss_visual_problems = user_symptom22,
         total_symptom_score = user_total_symptom_score) %>% 
  mutate(headache_migraine_cluster_score = pcss_headache + pcss_light_sensitivity + pcss_noise_sensitivity,
         cognitive_cluster_score = pcss_difficulty_concentrating + pcss_difficulty_remembering + pcss_feeling_slow + pcss_feeling_foggy,
         anxiety_mood_cluster_score = pcss_sadness + pcss_irritability + pcss_more_emotional + pcss_nervousness + pcss_numbness,
         ocular_motor_cluster_score = pcss_visual_problems,
         vestibular_cluster_score = pcss_dizziness + pcss_balance_problems + pcss_nausea + pcss_vomiting,
         sleep_cluster_score = pcss_drowsiness + pcss_fatigue + pcss_trouble_falling_asleep + pcss_excessive_sleep + pcss_loss_of_sleep)



impact$test_type

# extracting post-injury 1 test type

impact_post_injury_1 <- impact %>% 
  filter(test_type == "Post-Injury 1") %>% 
  na.omit()


# attempt at joining RTP and impact post-injury 1 data 

rtp_impact_post_injury_1 <- left_join(all_rtp, impact_post_injury_1)

write_xlsx(rtp_impact_post_injury_1, "rtp_impact_post_injury_1.xlsx")

sims_impact_2 <- rtp_impact_post_injury_1 %>% 
  drop_na(test_date)

write_xlsx(sims_impact_2, "sims_impact_2.xlsx")


# post 10.8.20 meeting where I'm joining Sims and Impact data centered on onset, RTL date, and RTP date from SIMS data and post-injury 1 from impact data

clean_rtl_data <- left_join(rtl_update, impact_post_injury_1)

clean_rtl_data <- clean_rtl_data %>% 
  na.omit()

# actually wound up with less data than originally had so best to continue with previous file 


str(sims_impact_2)

sims_impact_2$test_date <- as.Date(sims_impact_2$test_date, format = "%m/%d/%Y")

str(sims_impact_2)

final_rtl_rtp_data <- sims_impact_2 %>% 
  mutate(days_between_injury_test_date = test_date - onset) %>% 
  mutate(days_between_injury_test_date = as.numeric(days_between_injury_test_date))

create_react_time(final_rtl_rtp_data, days_between_injury_test_date)

final_rtl_rtp_data_2 <- final_rtl_rtp_data %>% 
  filter(days_between_injury_test_date >= 0 & days_between_injury_test_date <= 30)

create_react_time(final_rtl_rtp_data_2, days_between_injury_test_date)


#deidentified - use this data set going forward for analyses post 10.8 meeting
final_rtl_rtp_data_3 <- final_rtl_rtp_data_2 %>% 
  select(-c(4:5))

write_xlsx(final_rtl_rtp_data_3, "final_rtl_rtp_data_3.xlsx")

```

## Data Description 

To create a valid data frame consisting of ImPACT scores, PCSS scores, and RTL/RTP information from the SIMS data set, the following steps were taken: 

1. Injuries labeled as "Head Concussion" were identified and isolated from the SIMS data set. 
2. Three variables were created to represent the duration of time from onset to RTP step 2 (*Return to School Full Time*), RTP step 2 to RTP step 7 (*Full Return to Activity*), and from onset to RTP step 7. These three variables are referred to as:
  + `onset_rtl_total_days`
  + `rtl_rtp_total_days`
  + `onset_rtp_total_days`
3. Missing data on the dates of injury onset as well as the achievement of RTP steps 2 and 7 was removed. 
4. Individuals with a duration of time less than 0 days for the aforementioned three variables were removed.
5. This data set then consisted of 827 injuries
6. When combined with the ImPACT Post-Injury 1 data set, the removal of missing data left 238 injuries 
7. A new variable was created (`days_between_injury_test_date`) to quantify the duration of time between the onset date (SIMS data set) and the test date (ImPACT data set). Injuries were kept in the data set if the duration of time from onset to test date was between 0-30 days. With injuries outside this range removed, the new data set to be used for analysis consists of 208 injuries. 

## Data Exploration - SIMS Demographic Information {.tabset .tabset-fade .tabset-pills}

### Gender 

```{r, include=FALSE}
gender_total_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(gender) %>% 
  summarize(total = n()) %>% 
  reactable(
    columns = list(
      gender = colDef(name = "Gender"),
      total = colDef(name = "Total")),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
gender_total_tbl
```

### Age 

```{r, include=FALSE}
concussion_age_total_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  summarize(total = n()) %>% 
  reactable(
    columns = list(
      age = colDef(name = "Age"),
      total = colDef(name = "Total")),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
concussion_age_total_tbl
```

### League

```{r, include=FALSE}
league_total_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  summarize(total = n()) %>% 
  reactable(
    columns = list(
      league = colDef(name = "League"),
      total = colDef(name = "Total")),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
league_total_tbl
```

### School 

```{r, include=FALSE}
school_total_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(league, school) %>% 
  summarize(total = n()) %>% 
  arrange(desc(total)) %>% 
  reactable(
    columns = list(
      league = colDef(name = "League"),
      school = colDef(name = "School"),
      total = colDef(name = "Total")),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
school_total_tbl
```

### Sport 

```{r, include=FALSE}
sport_total_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(sport) %>% 
  summarize(total = n()) %>% 
  arrange(desc(total)) %>% 
  reactable(
    columns = list(
      sport = colDef(name = "Sport"),
      total = colDef(name = "Total")),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
sport_total_tbl
```

### Sport Level 

```{r, include=FALSE}
level_total_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(level) %>% 
  summarize(total = n()) %>% 
  reactable(
    columns = list(
      level = colDef(name = "Level"),
      total = colDef(name = "Total")),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
level_total_tbl
```

## Data Exploration - SIMS RTP Information 

```{r, include=FALSE}
head(final_rtl_rtp_data_3)

ggplot(final_rtl_rtp_data_3, aes(onset_rtl_total_days)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 10) +
  facet_wrap(~gender, ncol = 1) +
  labs(x = "Number of Days",
       y = "Number of Individuals")

time_hist <- function(df, x) {
  ggplot(df, aes({{x}})) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 10) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Number of Days",
       y = "Number of Individuals")
}

time_hist(final_rtl_rtp_data_3, onset_rtl_total_days)

age_onset_rtp_time <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(onset_rtp_total_days)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Number of Days",
       y = "Number of Individuals", 
       title = glue("Number of Days From Injury Onset to RTP Completion:\n Age {.x}"))))

age_onset_rtp_time$plots[[1]] #age 18
age_onset_rtp_time$plots[[2]] #age 15
age_onset_rtp_time$plots[[3]] #age 14
age_onset_rtp_time$plots[[4]] #age 17
age_onset_rtp_time$plots[[5]] #age 16
age_onset_rtp_time$plots[[6]] #one individual for this one so not really needed 

age_onset_rtl_time <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(onset_rtl_total_days)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Number of Days",
       y = "Number of Individuals", 
       title = glue("Number of Days From Injury Onset to RTL Completion:\n Age {.x}"))))

age_onset_rtl_time$plots[[1]] #age 18
age_onset_rtl_time$plots[[2]] #age 15
age_onset_rtl_time$plots[[3]] #age 14
age_onset_rtl_time$plots[[4]] #age 17
age_onset_rtl_time$plots[[5]] #age 16
age_onset_rtl_time$plots[[6]] #one individual for this one so not really needed 

age_rtl_rtp_time <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(rtl_rtp_total_days)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Number of Days",
       y = "Number of Individuals", 
       title = glue("Number of Days from RTL Completion to RTP Completion:\n Age {.x}"))))

age_rtl_rtp_time$plots[[1]] #age 18
age_rtl_rtp_time$plots[[2]] #age 15
age_rtl_rtp_time$plots[[3]] #age 14
age_rtl_rtp_time$plots[[4]] #age 17
age_rtl_rtp_time$plots[[5]] #age 16
age_rtl_rtp_time$plots[[6]] #one individual for this one so not really needed 


ggplot(final_rtl_rtp_data_3, aes(onset_rtp_total_days, gender)) +
  ggridges::geom_density_ridges(color = "white",
                                fill = "#A9E5C5") +
  theme(plot.title = element_text(hjust = 0.5)) + 
  labs(x = "Number of Days",
       y = "")
  
all_leagues_plot <- function(df, x, y) {
  ggplot(df, aes({{x}}, {{y}})) +
  ggridges::geom_density_ridges(color = "white",
                                fill = "#A9E5C5") +
  theme(plot.title = element_text(hjust = 0.5)) + 
  labs(x = "Number of Days",
       y = "")
}

all_leagues_plot(final_rtl_rtp_data_3, onset_rtp_total_days, gender) +
  labs(title = "Number of Days from Injury Onset\n to RTP Completion")

league_onset_rtp_time <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  nest() %>% 
  mutate(plots = pmap(list(league, data), 
  ~ggplot(..2, aes(onset_rtp_total_days, gender)) +
  ggridges::geom_density_ridges(color = "white",
                                fill = "#A9E5C5") +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Number of Days", 
       y = "",
       title = glue("Number of Days from Injury Onset\n to RTP Completion: {.x}"))))

league_onset_rtp_time$plots[[1]] #BIIF
league_onset_rtp_time$plots[[2]] #KIF
league_onset_rtp_time$plots[[3]] #MIL

league_onset_rtl_time <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  nest() %>% 
  mutate(plots = pmap(list(league, data), 
  ~ggplot(..2, aes(onset_rtl_total_days, gender)) +
  ggridges::geom_density_ridges(color = "white",
                                fill = "#A9E5C5") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Number of Days", 
       y = "",
       title = glue("Number of Days from Injury Onset\n to RTL Completion: {.x}"))))

league_onset_rtl_time$plots[[1]] #BIIF
league_onset_rtl_time$plots[[2]] #KIF
league_onset_rtl_time$plots[[3]] #MIL

league_rtl_rtp_time <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  nest() %>% 
  mutate(plots = pmap(list(league, data), 
  ~ggplot(..2, aes(rtl_rtp_total_days, gender)) +
  ggridges::geom_density_ridges(color = "white",
                                fill = "#A9E5C5") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Number of Days", 
       y = "",
       title = glue("Number of Days from RTL Completion\n to RTP Completion: {.x}"))))

league_rtl_rtp_time$plots[[1]] #BIIF
league_rtl_rtp_time$plots[[2]] #KIF
league_rtl_rtp_time$plots[[3]] #MIL

```

### Duration of Time from Onset to RTP Completion {.tabset .tabset-fade .tabset-pills}

#### Quick Summary

```{r, include=TRUE}
create_react_time(final_rtl_rtp_data_3, onset_rtp_total_days)
```

#### Gender Summary 

```{r, include=FALSE}
gender_onset_rtp_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(gender) %>% 
  summarize(mean = mean(onset_rtp_total_days),
            sd = sd(onset_rtp_total_days),
            min = min(onset_rtp_total_days),
            max = max(onset_rtp_total_days),
            total = length(onset_rtp_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      gender = colDef(name = "Gender"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )

```

```{r, include=TRUE}
gender_onset_rtp_tbl
```

#### Age Summary

```{r, include=FALSE}
age_onset_rtp_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  summarize(mean = mean(onset_rtp_total_days),
            sd = sd(onset_rtp_total_days),
            min = min(onset_rtp_total_days),
            max = max(onset_rtp_total_days),
            total = length(onset_rtp_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      age = colDef(name = "Age"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
age_onset_rtp_tbl
```

#### League Summary

```{r, include=FALSE}
league_onset_rtp_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  summarize(mean = mean(onset_rtp_total_days),
            sd = sd(onset_rtp_total_days),
            min = min(onset_rtp_total_days),
            max = max(onset_rtp_total_days),
            total = length(onset_rtp_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      league = colDef(name = "League"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
league_onset_rtp_tbl
```

#### Visualizations 

##### Age and Gender {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
time_hist(final_rtl_rtp_data_3, onset_rtp_total_days) +
  labs(title = "Number of Days From Injury Onset to RTP Completion")
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_onset_rtp_time$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_onset_rtp_time$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_onset_rtp_time$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_onset_rtp_time$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_onset_rtp_time$plots[[1]]
```

##### League and Gender {.tabset .tabset-fade .tabset-pills}

###### All Leagues

```{r, include=TRUE, fig.height=6}
all_leagues_plot(final_rtl_rtp_data_3, onset_rtp_total_days, gender) +
  labs(title = "Number of Days from Injury Onset\n to RTP Completion")
```

###### BIIF

```{r, include=TRUE, fig.height=6}
league_onset_rtp_time$plots[[1]] 
```

###### KIF

```{r, include=TRUE, fig.height=6}
league_onset_rtp_time$plots[[2]] 
```

###### MIL

```{r, include=TRUE, fig.height=6}
league_onset_rtp_time$plots[[3]] 
```

### Duration of Time from Onset to RTL Completion {.tabset .tabset-fade .tabset-pills}

#### Quick Summary

```{r, include=TRUE}
create_react_time(final_rtl_rtp_data_3, onset_rtl_total_days)
```

#### Gender Summary 

```{r, include=FALSE}
gender_onset_rtl_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(gender) %>% 
  summarize(mean = mean(onset_rtl_total_days),
            sd = sd(onset_rtl_total_days),
            min = min(onset_rtl_total_days),
            max = max(onset_rtl_total_days),
            total = length(onset_rtl_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      gender = colDef(name = "Gender"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )

```

```{r, include=TRUE}
gender_onset_rtl_tbl
```

#### Age Summary

```{r, include=FALSE}
age_onset_rtl_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  summarize(mean = mean(onset_rtl_total_days),
            sd = sd(onset_rtl_total_days),
            min = min(onset_rtl_total_days),
            max = max(onset_rtl_total_days),
            total = length(onset_rtl_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      age = colDef(name = "Age"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
age_onset_rtl_tbl
```

#### League Summary

```{r, include=FALSE}
league_onset_rtl_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  summarize(mean = mean(onset_rtl_total_days),
            sd = sd(onset_rtl_total_days),
            min = min(onset_rtl_total_days),
            max = max(onset_rtl_total_days),
            total = length(onset_rtl_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      league = colDef(name = "League"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
league_onset_rtl_tbl
```

#### Visualizations 

##### Age and Gender {.tabset .tabset-fade .tabset-pills}

###### All Ages

```{r, include=TRUE, fig.height=6}
time_hist(final_rtl_rtp_data_3, onset_rtl_total_days) +
  labs(title = "Number of Days from Injury Onset to RTL Completion")
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_onset_rtl_time$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_onset_rtl_time$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_onset_rtl_time$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_onset_rtl_time$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_onset_rtl_time$plots[[1]]
```

##### League and Gender {.tabset .tabset-fade .tabset-pills}

###### All Leagues 

```{r, include=TRUE, fig.height=6}
all_leagues_plot(final_rtl_rtp_data_3, onset_rtl_total_days, gender) +
  labs(title = "Number of Days from Injury Onset\n to RTL Completion")
```

###### BIIF

```{r, include=TRUE, fig.height=6}
league_onset_rtl_time$plots[[1]] 
```

###### KIF

```{r, include=TRUE, fig.height=6}
league_onset_rtl_time$plots[[2]] 
```

###### MIL

```{r, include=TRUE, fig.height=6}
league_onset_rtl_time$plots[[3]] 
```


### Duration of Time from RTL Completion to RTP Completion {.tabset .tabset-fade .tabset-pills}

#### Quick Summary

```{r, include=TRUE}
create_react_time(final_rtl_rtp_data_3, rtl_rtp_total_days)
```

#### Gender Summary 

```{r, include=FALSE}
gender_rtl_rtp_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(gender) %>% 
  summarize(mean = mean(rtl_rtp_total_days),
            sd = sd(rtl_rtp_total_days),
            min = min(rtl_rtp_total_days),
            max = max(rtl_rtp_total_days),
            total = length(rtl_rtp_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      gender = colDef(name = "Gender"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )

```

```{r, include=TRUE}
gender_rtl_rtp_tbl
```

#### Age Summary

```{r, include=FALSE}
age_rtl_rtp_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  summarize(mean = mean(rtl_rtp_total_days),
            sd = sd(rtl_rtp_total_days),
            min = min(rtl_rtp_total_days),
            max = max(rtl_rtp_total_days),
            total = length(rtl_rtp_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      age = colDef(name = "Age"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
age_rtl_rtp_tbl
```

#### League Summary

```{r, include=FALSE}
league_rtl_rtp_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  summarize(mean = mean(rtl_rtp_total_days),
            sd = sd(rtl_rtp_total_days),
            min = min(rtl_rtp_total_days),
            max = max(rtl_rtp_total_days),
            total = length(rtl_rtp_total_days)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      league = colDef(name = "League"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
league_rtl_rtp_tbl
```

#### Visualizations 

##### Age and Gender {.tabset .tabset-fade .tabset-pills}

###### All Ages

```{r, include=TRUE, fig.height=6}
time_hist(final_rtl_rtp_data_3, rtl_rtp_total_days) +
  labs(title = "Number of Days from RTL Completion to RTP Completion")
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_rtl_rtp_time$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_rtl_rtp_time$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_rtl_rtp_time$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_rtl_rtp_time$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_rtl_rtp_time$plots[[1]]
```

##### League and Gender {.tabset .tabset-fade .tabset-pills}

###### All Leagues 

```{r, include=TRUE, fig.height=6}
all_leagues_plot(final_rtl_rtp_data_3, rtl_rtp_total_days, gender) +
  labs(title = "Number of Days from RTL Completion\n to RTP Completion")
```

###### BIIF

```{r, include=TRUE, fig.height=6}
league_rtl_rtp_time$plots[[1]] 
```

###### KIF

```{r, include=TRUE, fig.height=6}
league_rtl_rtp_time$plots[[2]] 
```

###### MIL

```{r, include=TRUE, fig.height=6}
league_rtl_rtp_time$plots[[3]] 
```



## Data Exploration - ImPACT PCSS Scores 

### Time between Injury Onset and Test Date {.tabset .tabset-fade .tabset-pills}

To calculate the duration of time from injury onset (`onset`) and ImPACT test date where PCSS scores were collected (`test_date`), a variable was created (`days_between_injury_test_date`) to represent this duration of time. Injuries where testing occurred more than 30 days after the injury were removed from the data set. 

#### Whole Sample 

```{r, include=TRUE}
create_react_time(final_rtl_rtp_data_3, days_between_injury_test_date)
```

#### League

```{r, include=FALSE}
league_time_between_injury_test_tbl <- final_rtl_rtp_data_3 %>% 
  group_by(league) %>% 
  summarize(mean = mean(days_between_injury_test_date),
            sd = sd(days_between_injury_test_date),
            min = min(days_between_injury_test_date),
            max = max(days_between_injury_test_date),
            total = length(days_between_injury_test_date)) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      league = colDef(name = "League"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " days")),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
```

```{r, include=TRUE}
league_time_between_injury_test_tbl
```

### PCSS Symptom Category Description 

Using Lumba-Brown et al. (2019) and Harmon et al. (2019) as references, the 22 PCSS symptoms were organized into the following six symptom clusters: 

1. Headache-Migraine Symptoms Cluster (Total Possible Score: 18)
  + Headache (PCSS symptom 1)
  + Light Sensitivity (PCSS symptom 11)
  + Noise Sensitivity (PCSS symptom 12)
2. Cognitive Symptoms Cluster (Total Possible Score: 24)
  + Difficulty Concentrating (PCSS symptom 20)
  + Difficulty Remembering (PCSS symptom 21)
  + Feeling "Slow" (PCSS symptom 18)
  + Feeling "Foggy" (PCSS symptom 19)
3. Anxiety-Mood Symptoms Cluster (Total Possible Score: 30)
  + Irritability (PCSS symptom 13)
  + Sadness (PCSS symptom 14)
  + Nervousness (PCSS symptom 15)
  + More Emotional (PCSS symptom 16)
  + Numbness (PCSS symptom 17)
4. Ocular-Motor Symptoms Cluster (Total Possible Score: 6)
  + Visual Problems (PCSS symptom 22)
5. Vestibular Symptoms Cluster (Total Possible Score: 24)
  + Dizziness (PCSS symptom 5)
  + Balance Problems (PCSS symptom 4)
  + Nausea (PCSS symptom 2)
  + Vomiting (PCSS symptom 3)
6. Sleep Symptoms Cluster (Total Possible Score: 30) 
  + Fatigue (PCSS symptom 6)
  + Trouble Falling Asleep (PCSS symptom 7)
  + Excessive Sleep (PCSS symptom 8)
  + Loss of Sleep (PCSS symptom 9)
  + Drowsiness (PCSS symptom 10)


PCSS Total Possible Score: 132

### PCSS Score Summaries 

#### Total Score (Total Possible Score: 132) {.tabset .tabset-fade .tabset-pills}

```{r, include=FALSE}
create_react(final_rtl_rtp_data_3, total_symptom_score)

gender_pcss_tbl <- function(df, x, y) {
  df %>% 
  group_by({{x}}) %>% 
  summarize(mean = mean({{y}}),
            sd = sd({{y}}),
            min = min({{y}}),
            max = max({{y}}),
            total = length({{y}})) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      gender = colDef(name = "Gender"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE)),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE)),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE)),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE)),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE, suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
}

gender_pcss_tbl(final_rtl_rtp_data_3, gender, total_symptom_score)

age_pcss_tbl <- function(df, x, y) {
  df %>% 
  group_by({{x}}) %>% 
  summarize(mean = mean({{y}}),
            sd = sd({{y}}),
            min = min({{y}}),
            max = max({{y}}),
            total = length({{y}})) %>%
  mutate(mean = as.numeric(mean),
         sd = as.numeric(sd),
         min = as.numeric(min),
         max = as.numeric(max),
         total = as.numeric(total)) %>% 
  reactable(
    columns = list(
      age = colDef(name = "Age"),
      mean = colDef(name = "Mean",
                    format = colFormat(digits = 2, separators = TRUE)),
      sd = colDef(name = "SD",
                  format = colFormat(digits = 2, separators = TRUE)),
      min = colDef(name = "Min",
                   format = colFormat(digits = 2, separators = TRUE)),
      max = colDef(name = "Max",
                   format = colFormat(digits = 2, separators = TRUE)),
      total = colDef(name = "Total",
                   format = colFormat(digits = 2, separators = TRUE))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
  )
}

age_pcss_tbl(final_rtl_rtp_data_3, age, total_symptom_score)


```

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, total_symptom_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, total_symptom_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, total_symptom_score)
```

##### Visualizations {.tabset .tabset-fade .tabset-pills}

```{r, include=FALSE}

#non age function score plot 

ggplot(final_rtl_rtp_data_3, aes(total_symptom_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 10) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals",
       title = "Symptom Score")

symptom_hist <- function(df, x) {
  ggplot(df, aes({{x}})) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 10) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals",
       title = "Symptom Score")
}

symptom_hist(final_rtl_rtp_data_3, total_symptom_score)

#total score
age_total_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(total_symptom_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Total Symptom Score: Age {.x}"))))

age_total_pcss_score$plots[[1]] #age 18
age_total_pcss_score$plots[[2]] #age 15
age_total_pcss_score$plots[[3]] #age 14
age_total_pcss_score$plots[[4]] #age 17
age_total_pcss_score$plots[[5]] #age 16
age_total_pcss_score$plots[[6]] #one individual for this one so not really needed 

# headache-migraine cluster

age_headache_migraine_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(headache_migraine_cluster_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Headache-Migraine Symptoms Cluster Score:\n Age {.x}"))))

age_headache_migraine_pcss_score$plots[[1]] #age 18
age_headache_migraine_pcss_score$plots[[2]] #age 15
age_headache_migraine_pcss_score$plots[[3]] #age 14
age_headache_migraine_pcss_score$plots[[4]] #age 17
age_headache_migraine_pcss_score$plots[[5]] #age 16
age_headache_migraine_pcss_score$plots[[6]] #one individual for this one so not really needed 

#cognitive symptoms
age_cognitive_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(cognitive_cluster_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Cognitive Symptoms Cluster Score:\n Age {.x}"))))

age_cognitive_pcss_score$plots[[1]] #age 18
age_cognitive_pcss_score$plots[[2]] #age 15
age_cognitive_pcss_score$plots[[3]] #age 14
age_cognitive_pcss_score$plots[[4]] #age 17
age_cognitive_pcss_score$plots[[5]] #age 16
age_cognitive_pcss_score$plots[[6]] #one individual for this one so not really needed 

# anxiety mood 

age_anxiety_mood_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(anxiety_mood_cluster_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Anxiety-Mood Symptoms Cluster Score:\n Age {.x}"))))

age_anxiety_mood_pcss_score$plots[[1]] #age 18
age_anxiety_mood_pcss_score$plots[[2]] #age 15
age_anxiety_mood_pcss_score$plots[[3]] #age 14
age_anxiety_mood_pcss_score$plots[[4]] #age 17
age_anxiety_mood_pcss_score$plots[[5]] #age 16
age_anxiety_mood_pcss_score$plots[[6]] #one individual for this one so not really needed 


#ocular-motor

age_ocular_motor_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(ocular_motor_cluster_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Ocular-Motor Symptoms Cluster Score:\n Age {.x}"))))

age_ocular_motor_pcss_score$plots[[1]] #age 18
age_ocular_motor_pcss_score$plots[[2]] #age 15
age_ocular_motor_pcss_score$plots[[3]] #age 14
age_ocular_motor_pcss_score$plots[[4]] #age 17
age_ocular_motor_pcss_score$plots[[5]] #age 16
age_ocular_motor_pcss_score$plots[[6]] #one individual for this one so not really needed 


#vestibular symptoms 

age_vestibular_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(vestibular_cluster_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Vestibular Symptoms Cluster Score:\n Age {.x}"))))

age_vestibular_pcss_score$plots[[1]] #age 18
age_vestibular_pcss_score$plots[[2]] #age 15
age_vestibular_pcss_score$plots[[3]] #age 14
age_vestibular_pcss_score$plots[[4]] #age 17
age_vestibular_pcss_score$plots[[5]] #age 16
age_vestibular_pcss_score$plots[[6]] #one individual for this one so not really needed 


# sleep symptoms 

age_sleep_pcss_score <- final_rtl_rtp_data_3 %>% 
  group_by(age) %>% 
  nest() %>% 
  mutate(plots = pmap(list(age, data), 
  ~ggplot(..2, aes(sleep_cluster_score)) +
  geom_histogram(fill = "#56B4E9",
                color = "white", 
                alpha = 0.9,
                bins = 15) +
  facet_wrap(~gender, ncol = 1) +
  theme(plot.title = element_text(hjust = 0.5)) +  
  labs(x = "Score",
       y = "Number of Individuals", 
       title = glue("PCSS Sleep Symptoms Cluster Score:\n Age {.x}"))))

age_sleep_pcss_score$plots[[1]] #age 18
age_sleep_pcss_score$plots[[2]] #age 15
age_sleep_pcss_score$plots[[3]] #age 14
age_sleep_pcss_score$plots[[4]] #age 17
age_sleep_pcss_score$plots[[5]] #age 16
age_sleep_pcss_score$plots[[6]] #one individual for this one so not really needed 
```

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, total_symptom_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_total_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_total_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_total_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_total_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_total_pcss_score$plots[[1]]
```


#### Headache-Migraine Symptoms Cluster (Total Possible Score: 18) {.tabset .tabset-fade .tabset-pills}

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, headache_migraine_cluster_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, headache_migraine_cluster_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, headache_migraine_cluster_score)
```


##### Visualizations {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, headache_migraine_cluster_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_headache_migraine_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_headache_migraine_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_headache_migraine_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_headache_migraine_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_headache_migraine_pcss_score$plots[[1]]
```

#### Cognitive Symptoms Cluster (Total Possible Score: 24) {.tabset .tabset-fade .tabset-pills}

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, cognitive_cluster_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, cognitive_cluster_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, cognitive_cluster_score)
```


##### Visualizations {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, cognitive_cluster_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_cognitive_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_cognitive_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_cognitive_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_cognitive_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_cognitive_pcss_score$plots[[1]]
```


#### Anxiety-Mood Symptoms Cluster (Total Possible Score: 30) {.tabset .tabset-fade .tabset-pills}

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, anxiety_mood_cluster_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, anxiety_mood_cluster_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, anxiety_mood_cluster_score)
```


##### Visualizations {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, anxiety_mood_cluster_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_anxiety_mood_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_anxiety_mood_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_anxiety_mood_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_anxiety_mood_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_anxiety_mood_pcss_score$plots[[1]]
```


#### Ocular-Motor Symptoms Cluster (Total Possible Score: 6) {.tabset .tabset-fade .tabset-pills}

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, ocular_motor_cluster_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, ocular_motor_cluster_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, ocular_motor_cluster_score)
```


##### Visualizations {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, ocular_motor_cluster_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_ocular_motor_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_ocular_motor_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_ocular_motor_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_ocular_motor_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_ocular_motor_pcss_score$plots[[1]]
```


#### Vestibular Symptoms Cluster (Total Possible Score: 24) {.tabset .tabset-fade .tabset-pills}

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, vestibular_cluster_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, vestibular_cluster_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, vestibular_cluster_score)
```


##### Visualizations {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, vestibular_cluster_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_vestibular_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_vestibular_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_vestibular_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_vestibular_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_vestibular_pcss_score$plots[[1]]
```


#### Sleep Symptoms Cluster (Total Possible Score: 30) {.tabset .tabset-fade .tabset-pills}

##### Summary 

```{r, include=TRUE}
create_react(final_rtl_rtp_data_3, sleep_cluster_score)
```

##### Gender Summary

```{r, include=TRUE}
gender_pcss_tbl(final_rtl_rtp_data_3, gender, sleep_cluster_score)
```

##### Age Summary 

```{r, include=TRUE}
age_pcss_tbl(final_rtl_rtp_data_3, age, sleep_cluster_score)
```


##### Visualizations {.tabset .tabset-fade .tabset-pills}

###### All Ages 

```{r, include=TRUE, fig.height=6}
symptom_hist(final_rtl_rtp_data_3, sleep_cluster_score)
```

###### Age 14

```{r, include=TRUE, fig.height=6}
age_sleep_pcss_score$plots[[3]]
```

###### Age 15

```{r, include=TRUE, fig.height=6}
age_sleep_pcss_score$plots[[2]]
```

###### Age 16

```{r, include=TRUE, fig.height=6}
age_sleep_pcss_score$plots[[5]]
```

###### Age 17

```{r, include=TRUE, fig.height=6}
age_sleep_pcss_score$plots[[4]]
```

###### Age 18

```{r, include=TRUE, fig.height=6}
age_sleep_pcss_score$plots[[1]]
```